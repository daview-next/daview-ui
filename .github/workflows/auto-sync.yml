name: Automatically sync to a fork repository
on:
  push:
    branches:
      - feature/auto-sync-with-github-action

permissions: write-all

jobs:
  fetch:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check out code
      uses: actions/checkout@v2
    
    - name: Set up Git
      run: |
        git remote add fork_repo https://daview-next:${{ secrets.FORK_GITHUB_TOKEN }}@github.com/daview-next/daview-ui.git
        git fetch fork_repo

    - name: Fetch from origin repository
      run: |
        git fetch origin
        git checkout origin/feature/auto-sync-with-github-action

    - name: Merge changes into develop
      run: |
        git switch feature/auto-sync-with-github-action --detach
        git merge origin/feature/auto-sync-with-github-action --allow-unrelated-histories
        git push -f fork_repo HEAD:feature/auto-sync-with-github-action